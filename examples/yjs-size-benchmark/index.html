<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Y.Doc Size Benchmark</title>
		<style>
			* {
				box-sizing: border-box;
			}

			body {
				font-family:
					-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
				max-width: 100%;
				margin: 0;
				padding: 16px;
				background: #0a0a0a;
				color: #e5e5e5;
				min-height: 100vh;
			}

			h1 {
				font-size: 1.5rem;
				margin: 0 0 8px 0;
				color: #fff;
			}

			.subtitle {
				color: #888;
				font-size: 0.875rem;
				margin-bottom: 24px;
			}

			.controls {
				display: flex;
				flex-direction: column;
				gap: 12px;
				margin-bottom: 24px;
			}

			.control-row {
				display: flex;
				gap: 8px;
				flex-wrap: wrap;
			}

			label {
				display: flex;
				flex-direction: column;
				gap: 4px;
				font-size: 0.75rem;
				color: #888;
				flex: 1;
				min-width: 100px;
			}

			input,
			select {
				padding: 12px;
				border: 1px solid #333;
				border-radius: 8px;
				background: #1a1a1a;
				color: #fff;
				font-size: 1rem;
				width: 100%;
			}

			input:focus,
			select:focus {
				outline: none;
				border-color: #3b82f6;
			}

			button {
				padding: 14px 20px;
				border: none;
				border-radius: 8px;
				font-size: 1rem;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.15s;
			}

			.btn-primary {
				background: #3b82f6;
				color: white;
			}

			.btn-primary:hover {
				background: #2563eb;
			}

			.btn-primary:disabled {
				background: #1e3a5f;
				cursor: not-allowed;
			}

			.btn-danger {
				background: #dc2626;
				color: white;
			}

			.btn-danger:hover {
				background: #b91c1c;
			}

			.btn-secondary {
				background: #333;
				color: white;
			}

			.btn-secondary:hover {
				background: #444;
			}

			.stats-grid {
				display: grid;
				grid-template-columns: repeat(2, 1fr);
				gap: 12px;
				margin-bottom: 24px;
			}

			.stat-card {
				background: #1a1a1a;
				border: 1px solid #333;
				border-radius: 12px;
				padding: 16px;
			}

			.stat-label {
				font-size: 0.75rem;
				color: #888;
				text-transform: uppercase;
				letter-spacing: 0.05em;
				margin-bottom: 4px;
			}

			.stat-value {
				font-size: 1.5rem;
				font-weight: 700;
				color: #fff;
			}

			.stat-value.warning {
				color: #f59e0b;
			}

			.stat-value.danger {
				color: #ef4444;
			}

			.stat-value.success {
				color: #22c55e;
			}

			.progress-section {
				margin-bottom: 24px;
			}

			.progress-bar {
				height: 8px;
				background: #333;
				border-radius: 4px;
				overflow: hidden;
				margin-bottom: 8px;
			}

			.progress-fill {
				height: 100%;
				background: linear-gradient(90deg, #22c55e, #f59e0b, #ef4444);
				transition: width 0.3s;
			}

			.progress-labels {
				display: flex;
				justify-content: space-between;
				font-size: 0.75rem;
				color: #666;
			}

			.log-section {
				background: #1a1a1a;
				border: 1px solid #333;
				border-radius: 12px;
				padding: 16px;
				margin-bottom: 24px;
			}

			.log-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 12px;
			}

			.log-title {
				font-weight: 600;
				color: #fff;
			}

			.log-content {
				font-family: 'SF Mono', Monaco, monospace;
				font-size: 0.75rem;
				max-height: 200px;
				overflow-y: auto;
				color: #888;
			}

			.log-entry {
				padding: 4px 0;
				border-bottom: 1px solid #222;
			}

			.log-entry:last-child {
				border-bottom: none;
			}

			.log-entry.error {
				color: #ef4444;
			}

			.log-entry.success {
				color: #22c55e;
			}

			.log-entry.warning {
				color: #f59e0b;
			}

			.presets {
				display: flex;
				gap: 8px;
				flex-wrap: wrap;
				margin-bottom: 16px;
			}

			.preset-btn {
				padding: 8px 12px;
				font-size: 0.75rem;
				background: #262626;
				border: 1px solid #333;
			}

			.preset-btn:hover {
				background: #333;
				border-color: #444;
			}

			.info-box {
				background: #1e3a5f;
				border: 1px solid #3b82f6;
				border-radius: 8px;
				padding: 12px;
				margin-bottom: 24px;
				font-size: 0.875rem;
				color: #93c5fd;
			}

			.actions {
				display: flex;
				gap: 8px;
				flex-wrap: wrap;
			}

			.actions button {
				flex: 1;
				min-width: 120px;
			}

			@media (min-width: 640px) {
				body {
					padding: 32px;
					max-width: 800px;
					margin: 0 auto;
				}

				.stats-grid {
					grid-template-columns: repeat(4, 1fr);
				}

				.control-row {
					flex-wrap: nowrap;
				}
			}
		</style>
	</head>
	<body>
		<h1>Y.Doc Size Benchmark</h1>
		<p class="subtitle">Test single document limits on your device</p>

		<div class="info-box">
			<strong>How to use:</strong> Configure tables/rows below and click "Run
			Benchmark". Watch memory and timing to find your device's limits. Access
			from phone at <strong id="network-url">loading...</strong>
		</div>

		<div class="presets">
			<button class="btn-secondary preset-btn" onclick="applyPreset('small')">
				Small (1 table, 1k rows)
			</button>
			<button class="btn-secondary preset-btn" onclick="applyPreset('medium')">
				Medium (5 tables, 5k rows)
			</button>
			<button class="btn-secondary preset-btn" onclick="applyPreset('large')">
				Large (20 tables, 10k rows)
			</button>
			<button class="btn-secondary preset-btn" onclick="applyPreset('huge')">
				Huge (50 tables, 20k rows)
			</button>
		</div>

		<div class="controls">
			<div class="control-row">
				<label>
					Tables
					<input type="number" id="numTables" value="10" min="1" max="100" />
				</label>
				<label>
					Rows per table
					<input
						type="number"
						id="rowsPerTable"
						value="1000"
						min="100"
						max="100000"
						step="100"
					/>
				</label>
				<label>
					Fields per row
					<input type="number" id="fieldsPerRow" value="10" min="1" max="50" />
				</label>
			</div>
			<div class="control-row">
				<label>
					Field size (chars)
					<input type="number" id="fieldSize" value="50" min="10" max="1000" />
				</label>
				<label>
					Batch size
					<input type="number" id="batchSize" value="500" min="10" max="5000" />
				</label>
			</div>
		</div>

		<div class="actions">
			<button class="btn-primary" id="runBtn" onclick="runBenchmark()">
				Run Benchmark
			</button>
			<button
				class="btn-danger"
				id="stopBtn"
				onclick="stopBenchmark()"
				disabled
			>
				Stop
			</button>
			<button class="btn-secondary" onclick="resetDoc()">Reset Document</button>
			<button class="btn-secondary" onclick="downloadDoc()">
				Download .yjs
			</button>
		</div>

		<div class="stats-grid" style="margin-top: 24px">
			<div class="stat-card">
				<div class="stat-label">Doc Size</div>
				<div class="stat-value" id="docSize">0 KB</div>
			</div>
			<div class="stat-card">
				<div class="stat-label">Total Rows</div>
				<div class="stat-value" id="totalRows">0</div>
			</div>
			<div class="stat-card">
				<div class="stat-label">Memory (JS Heap)</div>
				<div class="stat-value" id="memoryUsage">-</div>
			</div>
			<div class="stat-card">
				<div class="stat-label">Write Speed</div>
				<div class="stat-value" id="writeSpeed">-</div>
			</div>
		</div>

		<div class="progress-section">
			<div class="progress-bar">
				<div class="progress-fill" id="progressFill" style="width: 0%"></div>
			</div>
			<div class="progress-labels">
				<span>0 MB</span>
				<span>10 MB (mobile limit)</span>
				<span>50 MB</span>
			</div>
		</div>

		<div class="stats-grid">
			<div class="stat-card">
				<div class="stat-label">Encode Time</div>
				<div class="stat-value" id="encodeTime">-</div>
			</div>
			<div class="stat-card">
				<div class="stat-label">Decode Time</div>
				<div class="stat-value" id="decodeTime">-</div>
			</div>
			<div class="stat-card">
				<div class="stat-label">Bytes/Row</div>
				<div class="stat-value" id="bytesPerRow">-</div>
			</div>
			<div class="stat-card">
				<div class="stat-label">Est. 3G Load</div>
				<div class="stat-value" id="loadTime3g">-</div>
			</div>
		</div>

		<div class="log-section">
			<div class="log-header">
				<span class="log-title">Activity Log</span>
				<button
					class="btn-secondary"
					style="padding: 6px 12px; font-size: 0.75rem"
					onclick="clearLog()"
				>
					Clear
				</button>
			</div>
			<div class="log-content" id="logContent">
				<div class="log-entry">Ready to benchmark...</div>
			</div>
		</div>

		<script type="module" src="/src/main.ts"></script>
	</body>
</html>
